@using Microsoft.SemanticKernel
@using Microsoft.SemanticKernel.ChatCompletion
@using Microsoft.SemanticKernel.Connectors.OpenAI
@using System.Text
@using Open.Blazor.Ui.Features.Shared.Models
@inject IJSRuntime JsRuntime
@if (_discourse is not null && _activeOllamaModels is not null)
{
    <FluentStack Orientation="Orientation.Horizontal"
                 HorizontalAlignment="HorizontalAlignment.Center"
                 VerticalAlignment="VerticalAlignment.Bottom">
        <FluentSelect TOption="OllamaModel"
                      Label="Select a model"
                      Items="@_activeOllamaModels.Models"
                      Id="listOfActiveModels"
                      Width="200px"
                      OptionText="@(p => p.Name)"
                      SelectedOption="_selectedModel"
                      SelectedOptionChanged="HandleSelectedOptionChanged" />
    </FluentStack>
    <FluentStack Id="chatWindow" Orientation="Orientation.Vertical"
                 HorizontalAlignment="HorizontalAlignment.Center"
                 VerticalAlignment="VerticalAlignment.Top"
                 VerticalGap="20"
                 Style="height: 85%;margin:10px;overflow-y:auto;padding:10px">


        @foreach (var message in _discourse.ChatMessages)
        {
            <ChatContent Message="message" />
        }

    </FluentStack>

    <FluentStack Orientation="Orientation.Horizontal"
                 HorizontalAlignment="HorizontalAlignment.Center"
                 VerticalAlignment="VerticalAlignment.Bottom">
        <FluentTextArea @bind-Value=_userMessage style="width:700px;margin-top:20px" Placeholder="Let's chat"></FluentTextArea>

        @if (!_isChatOngoing)
        {
            <FluentButton IconStart="@(new Icons.Filled.Size16.Send())" 
                          Appearance="Appearance.Stealth" OnClick="SendMessage" />
        }
        else
        {
            <FluentButton IconStart="@(new Icons.Filled.Size16.Stop())"
                          Appearance="Appearance.Stealth" OnClick="StopChat" />
        }


    </FluentStack>
}
@code {


    private async Task ScrollToBottom()
    {
        await JsRuntime.InvokeVoidAsync("ScrollToBottom", "chatWindow");
        StateHasChanged();
    }
}
